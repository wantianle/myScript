# 📖 Witt (What Is That Tag?) 使用指南

> **Witt** 是一款专为自动驾驶测试数据打造的一站式处理工具。它集成了数据检索、远程/本地切片、频道过滤、环境同步及多域（Multi-SOC）回放功能，旨在通过极简的交互解决复杂的 Cyber Record 数据链路问题。

---

## 🚀 核心特性

- **多模式支持**：无缝切换本地磁盘、NAS 模式。
- **智能切片**：支持基于 Tag 时间点的相对偏移切片（Before/After），支持负值偏移。
- **双域协同**：支持 SOC1 与 SOC2 数据合并查询回放，自动时间对齐。
- **手动模式**：支持终端文件/文件夹拖拽（兼容 Kitty `file://` 协议），即拖即播。
- **自动化审计**：自动生成 `meta.json`、`README.md` 及回放索引，操作记录全追溯。

---

## 🛠️ 环境准备

### 1. NAS 挂载要求
使用 NAS 模式前，请确保 NAS 已挂载且路径符合规范：
- **挂载点**：`/media/nas`
- **路径规范**：`/media/nas/00.raw/<YYYYMMDD>/<vehicle_name>/`

### 2. Docker 环境
- 确保当前用户在 `docker` 组中，或具备执行 `docker exec` 的权限。
- 本地 `/media` 目录需正确挂载至容器内（默认映射至容器内 `/media`）。

---

## 💡 功能详解

### 1. 全流程自动化 (选项 1)
**查询 -> 压缩/切片/同步 -> 回放**
- **时间参数说明**：
    - `Before`: Tag 之前的秒数（支持负数，代表 Tag 之后开始）。
    - `After`: Tag 之后的秒数（需满足 `|After| > |Before|`）。
- **覆盖逻辑**：若本地已存在同名 Tag 数据，程序将**自动清理旧数据**并重新执行切片，确保数据一致性。

### 2. 交互式回放 (选项 6)
回放功能分为两种模式：

#### A. 缓存库模式 (推荐)
系统自动扫描工作目录下的 `meta.json`。
- **多 SOC 合并**：若检测到 SOC1 和 SOC2 同时存在，可选 `[All]` 进行合播。
- **频道过滤**：支持在播放前选择“保留”的 Channel（如仅保留点云/融合数据），大幅降低 IO 开销，解决播放卡顿。

#### B. 手动拖拽模式
在回放界面输入 `m` 即可进入。
- **操作**：直接将 record 文件或整个文件夹拖入终端。
- **兼容性**：完美支持 Kitty 终端的 `file:///` 协议路径，自动处理路径空格。
- **智能排序**：自动识别文件名中的 `.0000x` 序号，跨 SOC 文件也能实现全局时序排列。

---

## 📂 存储结构规范

Witt 采用结构化存储，确保数据可自描述：
```text
dest_root/
└── 20260110/                  # 日期
    └── XZB600011/             # 车号
        └── 01.急刹/           # 任务序号.Tag名称
            ├── meta.json      # 核心元数据（时间轴、SOC信息）
            ├── README.md      # 自动生成的 tag 说明
            ├── soc1/          # SOC1 数据片段
            │   ├── version.json / version.txt
            │   └── *.record.0000x
            └── soc2/          # SOC2 数据片段
                └── ...
```

---

## ❓ 常见问题 (FAQ)

**Q: 远程切片速度很慢？**

A: 远程模式受限于网线带宽（通常为百兆或千兆）。建议通过“频道过滤”压缩数据，或检查是否有其他大量占用带宽的任务。

**Q: 日志在哪里查看？**

A: 所有的详细操作日志、切片审计及报错堆栈均保存在工作目录下的 `.witt/log/session_xxxx.log` 中。

---

## 🛠️ 开发者说明

- **常用配置项**：修改常用的车辆或路径配置项`setting.yaml`
- **UI 逻辑分离**：修改界面样式请查阅 `ui.py`。
- **数据解析**：路径与输入解析逻辑集中在 `parser.py`。

---
*Generated by Witt Documentation Team | 2026-01-16*
